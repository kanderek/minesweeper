function Grid(a,b){this.rowSize=a||8,this.columnSize=b||8,this.grid=this.createEmptyGrid()}function GameTimer(a,b,c,d){this.timePassed=b||0,this.isStopped=c||!0,this.incrementTimer=d||null,this.domDisplayElement=document.querySelector(a)}function MineField(a,b,c){this.numberOfMines=c||10,this.field=new Grid(a,b),this.MINE="!",this.mineLocations=this.placeMines(),this.placeNumbers()}function MineSweeper(a,b,c,d){this.mineField=new MineField(a,b,c),this.playerMineMap=new Grid(a,b),this.domElement=document.getElementById(d),this.FLAG="!",this.clearDomMineField(),this.buildDomMineField()}function handleChange(a){var b=a.target?a.target:a.srcElement,c="label"===b.tagName.toLowerCase()?b:b.nextSibling,d=b.id?b.id:b.previousSibling.id,e=document.getElementById(d);if(showAnxiety(),d){var f=d.slice(5),g=minesweeper.mineField.field.tileValue(f);a.shiftKey?(console.log("shift key held"),a.preventDefault(),c.classList.contains("flag")?(c.classList.remove("flag"),e.disabled=!1,flagCount=flagCount>0?flagCount-1:0,difficultyDom.getElementsByTagName("span")[1].innerHTML=mineCount-flagCount):(c.classList.add("flag"),e.disabled=!0,flagCount=mineCount>flagCount?flagCount+1:mineCount,difficultyDom.getElementsByTagName("span")[1].innerHTML=mineCount-flagCount)):e.disabled||(minesweeper.markPlayersMineMap(f)&&losingMove(),0!==g&&(c.innerHTML=g),minesweeper.syncDom(),minesweeper.isFieldClear()&&winningMove())}}function losingMove(){timer.stop(),faceDom.classList.add("dead-face"),minesweeper.addMineClass("show-mines"),playAgainModalDom.classList.add("show"),playAgainModalDom.classList.remove("hide"),playAgainModalDom.getElementsByTagName("h1")[0].innerHTML="Oh no! Are you Okay?"}function winningMove(){timer.stop(),playAgainModalDom.classList.add("show"),playAgainModalDom.classList.remove("hide"),playAgainModalDom.getElementsByTagName("h1")[0].innerHTML="Congrats! The world is a little safer..."}function showAnxiety(){faceDom.classList.remove("happy-face"),faceDom.classList.add("worried-face"),setTimeout(function(){faceDom.classList.add("happy-face"),faceDom.classList.remove("worried-face")},400)}function hideElement(a){a.classList.add("hide"),a.classList.remove("show")}function showElement(a){a.classList.remove("hide"),a.classList.add("show")}function newGameByDifficulty(a){var b=difficultyDom.getElementsByTagName("span");switch(faceDom.classList.remove("dead-face"),faceDom.classList.add("happy-face"),b[0].innerHTML=a,timer.stop(),timer.reset(),timer.start(),flagCount=0,a){case"easy":mineCount=10,minesweeper=new MineSweeper(8,8,mineCount,"mine-field"),b[1].innerHTML=mineCount;break;case"medium":mineCount=40,minesweeper=new MineSweeper(16,16,mineCount,"mine-field"),b[1].innerHTML=mineCount;break;case"hard":mineCount=99,minesweeper=new MineSweeper(30,16,mineCount,"mine-field"),b[1].innerHTML=mineCount}}Grid.prototype.createEmptyGrid=function(){for(var a=this.rowSize*this.columnSize,b={},c=1;a>=c;c++)b[c]="-";return b},Grid.prototype.tileValue=function(a,b){return void 0===b?this.grid[a]:(this.grid[a]=b,b)},Grid.prototype.print=function(){for(var a=this.rowSize*this.columnSize,b="",c=1;a>=c;c++)b+=this.grid[c]+" ",b+=c%this.rowSize===0?"\n":"";console.log(b)},Grid.prototype.nearestNeighbors=function(a){var b={};return a=parseInt(a,10),a%this.rowSize!==1&&(b[7]=a-1,void 0!==this.grid[a+this.rowSize-1]&&(b[6]=a+this.rowSize-1),void 0!==this.grid[a-this.rowSize-1]&&(b[8]=a-this.rowSize-1)),a%this.rowSize!==0&&(b[3]=a+1,void 0!==this.grid[a+this.rowSize+1]&&(b[4]=a+this.rowSize+1),void 0!==this.grid[a-this.rowSize+1]&&(b[2]=a-this.rowSize+1)),void 0!==this.grid[a-this.rowSize]&&(b[1]=a-this.rowSize),void 0!==this.grid[a+this.rowSize]&&(b[5]=a+this.rowSize),b},GameTimer.prototype.start=function(){this.isStopped=!1;var a=this;this.incrementTimer=setInterval(function(){a.timePassed+=1,a.refreshTimeDom()},1e3)},GameTimer.prototype.stop=function(){this.isStopped=!0;var a=this;clearInterval(a.incrementTimer)},GameTimer.prototype.reset=function(){this.timePassed=0,this.refreshTimeDom()},GameTimer.prototype.toString=function(){var a=this.timePassed<60?this.timePassed:this.timePassed%60,b=(this.timePassed-a)/60;return a=10>a?"0"+a:a,b+":"+a},GameTimer.prototype.refreshTimeDom=function(){try{this.domDisplayElement?this.domDisplayElement.getElementsByTagName("span")[0].innerHTML=this.toString():console.log(this.toString())}catch(a){console.log("there was an error drawing to dom")}},MineField.prototype.placeMines=function(){for(var a,b=this.numberOfMines,c=this.field.rowSize*this.field.columnSize,d={};b>0;)a=Math.ceil(Math.random()*c),a in d||(this.field.tileValue(a,this.MINE),d[a]=!0,b-=1);return d},MineField.prototype.placeNumbers=function(){for(var a,b=this.field.rowSize*this.field.columnSize,c={},d=1;b>=d;d++)if(a=0,this.field.tileValue(d)!==this.MINE){c=this.field.nearestNeighbors(d);for(var e in c)a+=this.field.tileValue(c[e])===this.MINE?1:0;this.field.tileValue(d,a)}},MineSweeper.prototype.markPlayersMineMap=function(a,b){var c=this.mineField.field.tileValue(a),d=!1;return c===this.mineField.MINE&&b!==this.FLAG?(console.log("You lose"),d=!0):0!==c?this.playerMineMap.tileValue(a,c):(this.playerMineMap.tileValue(a,c),this.connectedSafeTiles(a)),d},MineSweeper.prototype.placePlayerFlag=function(){},MineSweeper.prototype.connectedSafeTiles=function(a){var b,c,d,e=[],f={};if(0===this.mineField.field.tileValue(a))for(e.push(a);e.length>0;){d=e.pop(),b=this.playerMineMap.nearestNeighbors(d),f[d]=!0;for(var g in b)c=b[g],fieldValue=this.mineField.field.tileValue(c),this.playerMineMap.tileValue(c,fieldValue),0!==fieldValue||c in f||e.push(c)}},MineSweeper.prototype.isFieldClear=function(){for(var a,b=this.playerMineMap.rowSize*this.playerMineMap.columnSize,c=0;b>c;c++)if(a=this.mineField.field.tileValue(c+1),a!==this.mineField.MINE&&this.playerMineMap.tileValue(c+1)!==a)return!1;return!0},MineSweeper.prototype.endGame=function(){},MineSweeper.prototype.hint=function(){var a=this;this.addMineClass("show-mines"),setTimeout(function(){a.removeMineClass("show-mines")},2e3)},MineSweeper.prototype.addMineClass=function(a){var b=this.domElement.getElementsByTagName("label"),c=this.mineField.mineLocations;for(var d in c)b[parseInt(d,10)-1].classList.add(a)},MineSweeper.prototype.removeMineClass=function(a){var b=this.domElement.getElementsByTagName("label"),c=this.mineField.mineLocations;for(var d in c)b[parseInt(d,10)-1].classList.remove(a)},MineSweeper.prototype.syncDom=function(){for(var a,b=this.domElement.getElementsByTagName("input"),c=this.playerMineMap.rowSize*this.playerMineMap.columnSize,d=0;c>d;d++)a=this.playerMineMap.tileValue(d+1),"-"!==a&&(b[d].checked=!0,b[d].nextSibling.innerHTML=0!==a?a:"")},MineSweeper.prototype.buildDomMineField=function(){for(var a,b,c=this.domElement,d=document.createDocumentFragment(),e="",f=this.mineField.field.rowSize,g=this.mineField.field.columnSize,h=d.appendChild(document.createElement("tbody")),i=1;g>=i;i++){var j=document.createElement("tr");a=h.appendChild(j);for(var k=1;f>=k;k++){var l=document.createElement("td"),m=document.createElement("input"),n=document.createElement("label");e="tile-"+((i-1)*f+k),b=a.appendChild(l),m.setAttribute("id",e),m.setAttribute("type","radio"),b.appendChild(m),n.setAttribute("for",e),b.appendChild(n)}}c.appendChild(d)},MineSweeper.prototype.clearDomMineField=function(){for(var a=this.domElement;a.firstChild;)a.removeChild(a.firstChild)};var minesweeper=new MineSweeper(8,8,10,"mine-field"),timer=new GameTimer(".timer"),difficulty="easy",mineCount=10,flagCount=0,timerDom=document.querySelector(".timer"),difficultyDom=document.querySelector(".difficulty"),faceDom=document.querySelector(".face"),hintDom=document.querySelector(".hint"),difficultySelectDom=document.getElementById("select-puzzle-options"),menuGameSettingsDom=document.querySelector(".game-settings"),menuDropDownDom=document.querySelector(".game-menu-options"),playAgainModalDom=document.getElementById("play-again-modal"),gameRulesModalDom=document.getElementById("game-rules-modal");timer.start(),minesweeper.domElement.addEventListener("click",handleChange,!1),faceDom.addEventListener("click",function(a){a.target?a.target:a.srcElement;minesweeper.isFieldClear()||losingMove()},!1),menuGameSettingsDom.addEventListener("click",function(a){a.target?a.target:a.srcElement;menuDropDownDom.classList.toggle("show"),menuDropDownDom.classList.toggle("hide"),menuGameSettingsDom.classList.toggle("menu-button-active")},!1),difficultySelectDom.addEventListener("click",function(a){var b=a.target?a.target:a.srcElement;menuDropDownDom.classList.remove("show"),menuDropDownDom.classList.add("hide"),menuGameSettingsDom.classList.remove("menu-button-active"),difficulty=b.value,newGameByDifficulty(difficulty)},!1),hintDom.addEventListener("click",function(){minesweeper.hint()},!1),playAgainModalDom.addEventListener("click",function(a){var b=a.target?a.target:a.srcElement;console.log("modal clicked"),"a"===b.tagName.toLowerCase()&&(a.preventDefault(),hideElement(playAgainModalDom),newGameByDifficulty(difficulty))},!1),menuDropDownDom.addEventListener("click",function(a){var b=a.target?a.target:a.srcElement;"game-rules"===b.className&&(hideElement(menuDropDownDom),showElement(gameRulesModalDom))},!1),gameRulesModalDom.addEventListener("click",function(a){a.target?a.target:a.srcElement;hideElement(gameRulesModalDom)},!1);